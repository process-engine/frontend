{"version":3,"sources":["../src/frontend_service.js"],"names":["global","__CLIENT__","__SERVER__","__DISABLE_SSR__","__DEVTOOLS__","__DEVELOPMENT__","process","env","NODE_ENV","require","polyfill","fs","path","express","React","ReactDOM","HtmlHelper","PrettyError","match","ReduxAsyncConnect","loadOnServer","createHistory","Provider","routesProvider","createStore","pretty","WebpackIsomorphicTools","WebpackIsomorphicToolsConf","Webpack","mustache","nconf","merge","getFrontend","frontendConfig","reduxApiImpl","webpackIsomorphicTools","provideFrontend","req","res","next","refresh","history","originalUrl","reducer","reduxReducerPath","resolve","buildReduxReducerPath","reduxReducerFileName","store","reducers","hydrateOnClient","send","renderToString","assets","routes","location","error","redirectLocation","renderProps","redirect","pathname","search","status","then","component","navigator","userAgent","headers","bind","FrontendService","config","routeConfig","routedComponentsPath","AppComponentName","AppComponent","buildRoutedComponentsPath","NotFoundComponentName","NotFoundComponent","Object","keys","forEach","route","componentName","componentPath","relayQueriesHelperPath","relayQueries","buildRelayQueriesHelperPath","relayPrepareParams","buildRelayPrepareParamsPath","appQueries","AppComponentQueriesName","appPrepareParams","AppPreparedParamsFuncName","reduxApiConfig","buildRestReducerPath","restReducerFileName","use","fetch","helperTemplatePath","__dirname","readFile","readRouteConfigHelperTemplateErr","routeConfigHelperTemplateData","routeConfigObject","containerPath","relayQueriesPath","relayPrepareParamsPath","mainRoutePath","routePath","appComponentName","appComponentQueriesName","appName","name","map","key","idx","routeKeyName","routeIndex","routeName","breadcrumbName","breadcrumbIgnore","isIndexRoute","routePrepareParamFuncName","prepareParamFuncName","hasRouteComponentName","routeComponentPath","routeComponentName","routeComponentQueriesName","componentQueriesName","isLast","length","mkdir","frontendSrcPath","mkDirFrontendErr","code","helpersTargetPathName","mkDirHelperErr","routeHelperPathName","mkDirRoutesErr","writeFile","routeHelperFileName","render","toString","err","console","log","webpack","NO_WEBPACK","compiler","webpackConfig","port","parseInt","webpackPort","serverOptions","contentBase","webpackContentBaseProtocol","webpackContentBaseHost","webpackContentBasePort","quiet","noInfo","hot","inline","lazy","publicPath","output","stats","watchOptions","ignored","aggregateTimeout","poll","app","listen","onAppListening","info","isoToolsConfig","appConfig","webpackConfigPath","webpackEnvironment","webpackConfigFileName","Promise","server","normalize","cwd","linkTag","staticLinks","Array","push","exports","module"],"mappings":"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","file":"frontend_service.js","sourcesContent":["global.__CLIENT__ = false;\nglobal.__SERVER__ = true;\nglobal.__DISABLE_SSR__ = false;\nglobal.__DEVTOOLS__ = global.__DEVELOPMENT__ = process.env.NODE_ENV !== 'production';\n\nrequire('es6-promise').polyfill();\n\nimport 'isomorphic-fetch';\nimport reduxApi from 'redux-api';\nimport adapterFetch from 'redux-api/lib/adapters/fetch';\n\nconst fs = require('fs');\nconst path = require('path');\nconst express = require('express');\nconst React = require('react');\nconst ReactDOM = require('react-dom/server');\nconst HtmlHelper = require('./helpers/Html');\nconst PrettyError = require('pretty-error');\nconst match = require('react-router').match;\nconst ReduxAsyncConnect = require('redux-async-connect').ReduxAsyncConnect;\nconst loadOnServer = require('redux-async-connect').loadOnServer;\nconst createHistory = require('react-router/lib/createMemoryHistory');\nconst Provider = require('react-redux').Provider;\nconst routesProvider = require('./routes/routes');\nconst createStore = require('./redux/create');\nconst pretty = new PrettyError();\nconst WebpackIsomorphicTools = require('webpack-isomorphic-tools');\nconst WebpackIsomorphicToolsConf = require('./helpers/devtools/webpack/webpack-isomorphic-tools');\nconst Webpack = require('webpack');\nconst mustache = require('mustache');\nconst nconf = require('nconf');\n\nconst merge = require('lodash.merge');\n\nfunction getFrontend(frontendConfig, reduxApiImpl, webpackIsomorphicTools) {\n  return function provideFrontend(req, res, next) {\n    if (__DEVELOPMENT__) {\n      // Do not cache webpack stats: the script file would change since\n      // hot module replacement is enabled in the development env\n      webpackIsomorphicTools.refresh();\n    }\n\n    const history = createHistory(req.originalUrl);\n    let reducer = null;\n    if (frontendConfig.reduxReducerPath) {\n      reducer = require(path.resolve(frontendConfig.buildReduxReducerPath, frontendConfig.reduxReducerFileName));\n    }\n\n    const store = createStore(frontendConfig, reducer(reduxApiImpl.reducers), history);\n\n    function hydrateOnClient() {\n      res.send('<!doctype html>\\n' + ReactDOM.renderToString(\n          <HtmlHelper config={frontendConfig}\n                      assets={webpackIsomorphicTools.assets()}\n                      store={store}/>\n        )\n      );\n    }\n\n    if (__DISABLE_SSR__) {\n      hydrateOnClient();\n      return;\n    }\n\n    match({\n      history,\n      routes: routesProvider(store, frontendConfig),\n      location: req.originalUrl\n    }, (error, redirectLocation, renderProps) => {\n      if (redirectLocation) {\n        res.redirect(redirectLocation.pathname + redirectLocation.search);\n      } else if (error) {\n        res.status(500);\n        hydrateOnClient();\n      } else if (renderProps) {\n        loadOnServer({ ...renderProps, store }).then(() => {\n          const component = (\n            <Provider store={store} key=\"provider\">\n              <ReduxAsyncConnect {...renderProps}/>\n            </Provider>\n          );\n\n          res.status(200);\n\n          global.navigator = { userAgent: req.headers['user-agent'] };\n\n          res.send('<!doctype html>\\n' + ReactDOM.renderToString(\n              <HtmlHelper config={frontendConfig}\n                          assets={webpackIsomorphicTools.assets()}\n                          component={component} store={store}/>\n            )\n          );\n        });\n      } else {\n        res.status(404).send('Not found');\n      }\n    });\n  }.bind(this);\n}\n\nclass FrontendService {\n  config = null;\n\n  constructor() {\n  }\n\n  initialize() {\n    this.routeConfig = this.config.routeConfig;\n\n    if (this.config.routedComponentsPath) {\n      if (this.config.AppComponentName) {\n        this.config.AppComponent = require(path.resolve(this.config.buildRoutedComponentsPath, this.config.AppComponentName, this.config.AppComponentName));\n      }\n      if (this.config.NotFoundComponentName) {\n        this.config.NotFoundComponent = require(path.resolve(this.config.buildRoutedComponentsPath, this.config.NotFoundComponentName, this.config.NotFoundComponentName));\n      }\n    }\n\n    Object.keys(this.routeConfig).forEach((route) => {\n      if (this.routeConfig[route].componentName && !this.routeConfig[route].componentPath) {\n        this.routeConfig[route].component = require(path.resolve(this.config.buildRoutedComponentsPath, this.routeConfig[route].componentName, this.routeConfig[route].componentName));\n      } else if (this.routeConfig[route].componentPath) {\n        this.routeConfig[route].component = require(this.routeConfig[route].componentPath);\n      }\n    });\n\n    if (this.config.relayQueriesHelperPath) {\n      this.config.relayQueries = require(path.resolve(this.config.buildRelayQueriesHelperPath));\n      this.config.relayPrepareParams = require(path.resolve(this.config.buildRelayPrepareParamsPath));\n      this.config.appQueries = (this.config.relayQueries && this.config.relayQueries[this.config.AppComponentQueriesName] ? this.config.relayQueries[this.config.AppComponentQueriesName] : null);\n      this.config.appPrepareParams = (this.config.AppPreparedParamsFuncName && this.config.relayPrepareParams && this.config.relayPrepareParams[this.config.AppPreparedParamsFuncName] ? this.config.relayPrepareParams[this.config.AppPreparedParamsFuncName] : null);\n    }\n\n    this.reduxApiConfig = require(path.resolve(this.config.buildRestReducerPath, this.config.restReducerFileName));\n    this.reduxApiImpl = reduxApi(this.reduxApiConfig);\n    this.reduxApiImpl\n      .use(\"fetch\", adapterFetch(fetch))\n      .use(\"server\", true);\n\n    const helperTemplatePath = __dirname + '/templates/route_config_helper.mustache';\n\n    fs.readFile(helperTemplatePath, (readRouteConfigHelperTemplateErr, routeConfigHelperTemplateData) => {\n      if (readRouteConfigHelperTemplateErr) throw readRouteConfigHelperTemplateErr;\n\n      const routeConfigObject = {\n        containerPath: path.resolve(this.config.routedComponentsPath),\n        relayQueriesPath: path.resolve(this.config.relayQueriesHelperPath),\n        relayPrepareParamsPath: path.resolve(this.config.relayPrepareParamsPath),\n        mainRoutePath: this.config.routePath,\n        appComponentName: this.config.AppComponentName,\n        appComponentQueriesName: this.config.AppComponentQueriesName,\n        appName: this.config.appName,\n        name: this.config.name,\n        routes: Object.keys(this.config.routeConfig).map((key, idx) => {\n          return {\n            routeKeyName: key,\n            routeIndex: idx,\n            routeName: this.config.routeConfig[key].name,\n            breadcrumbName: this.config.routeConfig[key].breadcrumbName,\n            breadcrumbIgnore: this.config.routeConfig[key].breadcrumbIgnore || false,\n            routePath: this.config.routeConfig[key].path,\n            isIndexRoute: this.config.routeConfig[key].isIndexRoute,\n            routePrepareParamFuncName: this.config.routeConfig[key].prepareParamFuncName,\n            hasRouteComponentName: !(this.config.routeConfig[key].componentPath != null),\n            routeComponentPath: this.config.routeConfig[key].componentPath,\n            routeComponentName: this.config.routeConfig[key].componentName,\n            routeComponentQueriesName: this.config.routeConfig[key].componentQueriesName,\n            isLast: (idx >= Object.keys(this.config.routeConfig).length - 1)\n          }\n        })\n      };\n\n      //Routes are generated into the src and will be build into dist\n      // frontend\n      fs.mkdir(path.resolve(this.config.frontendSrcPath), (mkDirFrontendErr) => {\n        if (mkDirFrontendErr && mkDirFrontendErr.code != 'EEXIST') throw mkDirFrontendErr;\n\n        // helpers\n        fs.mkdir(path.resolve(this.config.frontendSrcPath, this.config.helpersTargetPathName), (mkDirHelperErr) => {\n          if (mkDirHelperErr && mkDirHelperErr.code != 'EEXIST') throw mkDirHelperErr;\n\n          // routes\n          fs.mkdir(path.resolve(this.config.frontendSrcPath, this.config.helpersTargetPathName, this.config.routeHelperPathName), (mkDirRoutesErr) => {\n            if (mkDirRoutesErr && mkDirRoutesErr.code != 'EEXIST') throw mkDirRoutesErr;\n\n            fs.writeFile(path.resolve(this.config.frontendSrcPath, this.config.helpersTargetPathName, this.config.routeHelperPathName, this.config.routeHelperFileName + '.js'), mustache.render(routeConfigHelperTemplateData.toString(), routeConfigObject), (err) => {\n              if (err) throw err;\n\n              console.log('RouteConfigHelper JS generated!');\n            });\n          });\n        });\n      });\n\n      if (this.config.webpack && process.env.NO_WEBPACK != \"1\") {\n        const compiler = Webpack(this.config.webpackConfig);\n\n        const port = parseInt(this.config.webpackPort);\n        const serverOptions = {\n          contentBase: this.config.webpackContentBaseProtocol + this.config.webpackContentBaseHost + ':' + this.config.webpackContentBasePort,\n          quiet: true,\n          noInfo: true,\n          hot: true,\n          inline: true,\n          lazy: false,\n          publicPath: this.config.webpackConfig.output.publicPath,\n          headers: { \"Access-Control-Allow-Origin\": '*' },\n          stats: \"minimal\",\n          watchOptions: {\n            ignored: /node_modules/,\n            aggregateTimeout: 500,\n            poll: 2000,\n          },\n        };\n\n        const app = new express();\n\n        app.use(require('webpack-dev-middleware')(compiler, serverOptions));\n        app.use(require('webpack-hot-middleware')(compiler));\n\n        app.listen(port, function onAppListening(err) {\n          if (err) {\n            console.error(err);\n          } else {\n            console.info('==> 🚧  Webpack development server listening on port %s', port);\n          }\n        });\n      }\n    });\n\n    const isoToolsConfig = WebpackIsomorphicToolsConf(this.config.appConfig);\n\n    if (this.config.webpack && this.config.webpackConfigPath) {\n      this.config.webpackConfig = require(path.resolve(this.config.webpackConfigPath, this.config.webpackEnvironment, this.config.webpackConfigFileName))(this.config, isoToolsConfig);\n    }\n\n    return new Promise((resolve) => {\n      this.webpackIsomorphicTools = new WebpackIsomorphicTools(isoToolsConfig).server(path.normalize(process.cwd()), () => {\n        resolve(true);\n      });\n    });\n  }\n\n  transformRoute(routeConfig) {\n    merge(this.config.routeConfig, routeConfig);\n  }\n\n  injectStaticLink(linkTag) {\n    if (!this.config.staticLinks) {\n      this.config.staticLinks = new Array();\n    }\n\n    this.config.staticLinks.push(linkTag);\n  }\n\n  getFrontend() {\n    return getFrontend.bind(this)(this.config, this.reduxApiImpl, this.webpackIsomorphicTools);\n  }\n}\n\nexports = module.exports = FrontendService;\nexports.HtmlHelper = HtmlHelper;\nexports.FrontendService = FrontendService;\n"]}