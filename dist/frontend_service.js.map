{"version":3,"sources":["../src/frontend_service.js"],"names":["global","__CLIENT__","__SERVER__","__DISABLE_SSR__","__DEVTOOLS__","__DEVELOPMENT__","process","env","NODE_ENV","fs","require","path","appRoot","normalize","cwd","express","React","ReactDOM","HtmlHelper","PrettyError","match","polyfill","ReduxAsyncConnect","loadOnServer","createHistory","Provider","routesProvider","createStore","pretty","WebpackIsomorphicTools","WebpackIsomorphicToolsConf","Webpack","mustache","nconf","getFrontend","frontendConfig","reduxApiImpl","webpackIsomorphicTools","provideFrontend","req","res","next","refresh","history","originalUrl","reducer","reduxReducerPath","resolve","reduxReducerFileName","store","reducers","hydrateOnClient","send","renderToString","assets","routes","location","error","redirectLocation","renderProps","redirect","pathname","search","status","then","component","navigator","userAgent","headers","bind","FrontendService","config","routeConfig","routedComponentsPath","AppComponentName","AppComponent","NotFoundComponentName","NotFoundComponent","Object","keys","forEach","route","componentName","relayQueriesHelperPath","relayQueries","relayPrepareParams","relayPrepareParamsPath","appQueries","AppQueries","appPrepareParams","AppPreparedParamsFuncName","reduxApiConfig","restReducerPath","restReducerFileName","use","fetch","helperTemplatePath","__dirname","readFile","readRouteConfigHelperTemplateErr","routeConfigHelperTemplateData","routeConfigObject","containerPath","relayQueriesPath","mainRoutePath","routePath","appComponentName","appName","name","map","key","idx","routeKeyName","routeIndex","routeName","breadcrumbName","breadcrumbIgnore","isIndexRoute","routePrepareParamFuncName","prepareParamFuncName","routeComponentName","isLast","length","mkdir","frontendPath","mkDirFrontendErr","code","helpersTargetPathName","mkDirHelperErr","routeHelperPathName","mkDirRoutesErr","writeFile","routeHelperFileName","render","toString","err","console","log","webpack","NO_WEBPACK","compiler","webpackConfig","port","parseInt","webpackPort","serverOptions","contentBase","webpackContentBaseProtocol","webpackContentBaseHost","webpackContentBasePort","quiet","noInfo","hot","inline","lazy","publicPath","output","stats","colors","app","listen","onAppListening","info","isoToolsConfig","appConfig","webpackConfigPath","webpackEnvironment","webpackConfigFileName","Promise","server","exports","module"],"mappings":"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","file":"frontend_service.js","sourcesContent":["global.__CLIENT__ = false;\nglobal.__SERVER__ = true;\nglobal.__DISABLE_SSR__ = false;\nglobal.__DEVTOOLS__ = global.__DEVELOPMENT__ = process.env.NODE_ENV !== 'production';\n\nconst fs = require('fs');\nconst path = require('path');\nconst appRoot = path.normalize(process.cwd());\nconst express = require('express');\n\nconst React = require('react');\nconst ReactDOM = require('react-dom/server');\n\nconst HtmlHelper = require('./helpers/Html');\nconst PrettyError = require('pretty-error');\nconst match = require('react-router').match;\n\nrequire('es6-promise').polyfill();\nimport 'isomorphic-fetch';\nimport reduxApi from 'redux-api';\nimport adapterFetch from 'redux-api/lib/adapters/fetch';\n\nconst ReduxAsyncConnect = require('redux-async-connect').ReduxAsyncConnect;\nconst loadOnServer = require('redux-async-connect').loadOnServer;\nconst createHistory = require('react-router/lib/createMemoryHistory');\nconst Provider = require('react-redux').Provider;\nconst routesProvider = require('./routes/routes');\nconst createStore = require('./redux/create');\n\nconst pretty = new PrettyError();\n\nconst WebpackIsomorphicTools = require('webpack-isomorphic-tools');\nconst WebpackIsomorphicToolsConf = require('./helpers/devtools/webpack/webpack-isomorphic-tools');\n\nconst Webpack = require('webpack');\nconst mustache = require('mustache');\n\nconst nconf = require('nconf');\n\nfunction getFrontend(frontendConfig, reduxApiImpl, webpackIsomorphicTools) {\n  return function provideFrontend(req, res, next) {\n    if (__DEVELOPMENT__) {\n      // Do not cache webpack stats: the script file would change since\n      // hot module replacement is enabled in the development env\n      webpackIsomorphicTools.refresh();\n    }\n\n    const history = createHistory(req.originalUrl);\n    let reducer = null;\n    if (frontendConfig.reduxReducerPath) {\n      reducer = require(path.resolve(frontendConfig.reduxReducerPath, frontendConfig.reduxReducerFileName));\n    }\n\n    const store = createStore(frontendConfig, reducer(reduxApiImpl.reducers), history);\n\n    function hydrateOnClient() {\n      res.send('<!doctype html>\\n' + ReactDOM.renderToString(\n        <HtmlHelper config={frontendConfig}\n                    assets={webpackIsomorphicTools.assets()}\n                    store={store}/>\n        )\n      );\n    }\n\n    if (__DISABLE_SSR__) {\n      hydrateOnClient();\n      return;\n    }\n\n    match({\n      history,\n      routes: routesProvider(store, frontendConfig),\n      location: req.originalUrl\n    }, (error, redirectLocation, renderProps) => {\n      if (redirectLocation) {\n        res.redirect(redirectLocation.pathname + redirectLocation.search);\n      } else if (error) {\n        res.status(500);\n        hydrateOnClient();\n      } else if (renderProps) {\n        loadOnServer({ ...renderProps, store }).then(() => {\n          const component = (\n            <Provider store={store} key=\"provider\">\n              <ReduxAsyncConnect {...renderProps}/>\n            </Provider>\n          );\n\n          res.status(200);\n\n          global.navigator = { userAgent: req.headers['user-agent'] };\n\n          res.send('<!doctype html>\\n' + ReactDOM.renderToString(\n            <HtmlHelper config={frontendConfig}\n                        assets={webpackIsomorphicTools.assets()}\n                        component={component} store={store}/>\n            )\n          );\n        });\n      } else {\n        res.status(404).send('Not found');\n      }\n    });\n  }.bind(this);\n}\n\nclass FrontendService {\n  config = null;\n\n  constructor() {}\n\n  initialize() {\n    this.routeConfig = this.config.routeConfig;\n\n    if (this.config.routedComponentsPath) {\n      if (this.config.AppComponentName) {\n        this.config.AppComponent = require(path.resolve(this.config.routedComponentsPath, this.config.AppComponentName, this.config.AppComponentName));\n      }\n      if (this.config.NotFoundComponentName) {\n        this.config.NotFoundComponent = require(path.resolve(this.config.routedComponentsPath, this.config.NotFoundComponentName, this.config.NotFoundComponentName));\n      }\n    }\n\n    Object.keys(this.routeConfig).forEach((route) => {\n      if (this.routeConfig[route].componentName) {\n        this.routeConfig[route].component = require(path.resolve(this.config.routedComponentsPath, this.routeConfig[route].componentName, this.routeConfig[route].componentName));\n      }\n    });\n\n    if (this.config.relayQueriesHelperPath) {\n      this.config.relayQueries = require(path.resolve(this.config.relayQueriesHelperPath));\n      this.config.relayPrepareParams = require(path.resolve(this.config.relayPrepareParamsPath));\n      this.config.appQueries = (this.config.relayQueries && this.config.relayQueries.AppQueries ? this.config.relayQueries.AppQueries : null);\n      this.config.appPrepareParams = (this.config.AppPreparedParamsFuncName && this.config.relayPrepareParams && this.config.relayPrepareParams[this.config.AppPreparedParamsFuncName] ? this.config.relayPrepareParams[this.config.AppPreparedParamsFuncName] : null);\n    }\n\n    this.reduxApiConfig = require(path.resolve(this.config.restReducerPath, this.config.restReducerFileName));\n    this.reduxApiImpl = reduxApi(this.reduxApiConfig);\n    this.reduxApiImpl\n      .use(\"fetch\", adapterFetch(fetch))\n      .use(\"server\", true);\n\n    const helperTemplatePath = __dirname + '/templates/route_config_helper.mustache';\n\n    fs.readFile(helperTemplatePath, (readRouteConfigHelperTemplateErr, routeConfigHelperTemplateData) => {\n      if (readRouteConfigHelperTemplateErr) throw readRouteConfigHelperTemplateErr;\n\n      const routeConfigObject = {\n        containerPath: path.resolve(this.config.routedComponentsPath),\n        relayQueriesPath: path.resolve(this.config.relayQueriesHelperPath),\n        relayPrepareParamsPath: path.resolve(this.config.relayPrepareParamsPath),\n        mainRoutePath: this.config.routePath,\n        appComponentName: this.config.AppComponentName,\n        appName: this.config.appName,\n        name: this.config.name,\n        routes: Object.keys(this.config.routeConfig).map((key, idx) => {\n          return {\n            routeKeyName: key,\n            routeIndex: idx,\n            routeName: this.config.routeConfig[key].name,\n            breadcrumbName: this.config.routeConfig[key].breadcrumbName,\n            breadcrumbIgnore: this.config.routeConfig[key].breadcrumbIgnore || false,\n            routePath: this.config.routeConfig[key].path,\n            isIndexRoute: this.config.routeConfig[key].isIndexRoute,\n            routePrepareParamFuncName: this.config.routeConfig[key].prepareParamFuncName,\n            routeComponentName: this.config.routeConfig[key].componentName,\n            isLast: (idx >= Object.keys(this.config.routeConfig).length - 1)\n          }\n        })\n      };\n\n      // frontend\n      fs.mkdir(path.resolve(this.config.frontendPath), (mkDirFrontendErr) => {\n        if (mkDirFrontendErr && mkDirFrontendErr.code != 'EEXIST') throw mkDirFrontendErr;\n\n        // helpers\n        fs.mkdir(path.resolve(this.config.frontendPath, this.config.helpersTargetPathName), (mkDirHelperErr) => {\n          if (mkDirHelperErr && mkDirHelperErr.code != 'EEXIST') throw mkDirHelperErr;\n\n          // routes\n          fs.mkdir(path.resolve(this.config.frontendPath, this.config.helpersTargetPathName, this.config.routeHelperPathName), (mkDirRoutesErr) => {\n            if (mkDirRoutesErr && mkDirRoutesErr.code != 'EEXIST') throw mkDirRoutesErr;\n\n              fs.writeFile(path.resolve(this.config.frontendPath, this.config.helpersTargetPathName, this.config.routeHelperPathName, this.config.routeHelperFileName + '.js'), mustache.render(routeConfigHelperTemplateData.toString(), routeConfigObject), (err) => {\n              if (err) throw err;\n\n              console.log('RouteConfigHelper JS generated!');\n            });\n          });\n        });\n      });\n\n      if (this.config.webpack && process.env.NO_WEBPACK != \"1\") {\n        const compiler = Webpack(this.config.webpackConfig);\n\n        const port = parseInt(this.config.webpackPort);\n        const serverOptions = {\n          contentBase: this.config.webpackContentBaseProtocol + this.config.webpackContentBaseHost + ':' + this.config.webpackContentBasePort,\n          quiet: true,\n          noInfo: true,\n          hot: true,\n          inline: true,\n          lazy: false,\n          publicPath: this.config.webpackConfig.output.publicPath,\n          headers: { \"Access-Control-Allow-Origin\": '*' },\n          stats: { colors: true }\n        };\n\n        const app = new express();\n\n        app.use(require('webpack-dev-middleware')(compiler, serverOptions));\n        app.use(require('webpack-hot-middleware')(compiler));\n\n        app.listen(port, function onAppListening(err) {\n          if (err) {\n            console.error(err);\n          } else {\n            console.info('==> ðŸš§  Webpack development server listening on port %s', port);\n          }\n        });\n      }\n    });\n\n    const isoToolsConfig = WebpackIsomorphicToolsConf(this.config.appConfig);\n\n    if (this.config.webpack && this.config.webpackConfigPath) {\n      this.config.webpackConfig = require(path.resolve(this.config.webpackConfigPath, this.config.webpackEnvironment, this.config.webpackConfigFileName))(this.config, isoToolsConfig);\n    }\n\n    return new Promise((resolve) => {\n      this.webpackIsomorphicTools = new WebpackIsomorphicTools(isoToolsConfig).server(path.normalize(process.cwd()), () => {\n        resolve(true);\n      });\n    });\n  }\n\n  getFrontend() {\n    return getFrontend.bind(this)(this.config, this.reduxApiImpl, this.webpackIsomorphicTools);\n  }\n}\n\nexports = module.exports = FrontendService;\nexports.HtmlHelper = HtmlHelper;\nexports.FrontendService = FrontendService;\n"]}