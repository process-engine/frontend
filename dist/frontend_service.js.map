{"version":3,"sources":["../src/frontend_service.js"],"names":["global","__CLIENT__","__SERVER__","__DISABLE_SSR__","__DEVTOOLS__","__DEVELOPMENT__","process","env","NODE_ENV","require","polyfill","fs","path","express","React","ReactDOM","HtmlHelper","PrettyError","match","ReduxAsyncConnect","loadOnServer","createHistory","Provider","routesProvider","createStore","pretty","WebpackIsomorphicTools","WebpackIsomorphicToolsConf","Webpack","mustache","nconf","getFrontend","frontendConfig","reduxApiImpl","webpackIsomorphicTools","provideFrontend","req","res","next","refresh","history","originalUrl","reducer","reduxReducerPath","resolve","reduxReducerFileName","store","reducers","hydrateOnClient","send","renderToString","assets","routes","location","error","redirectLocation","renderProps","redirect","pathname","search","status","then","component","navigator","userAgent","headers","bind","FrontendService","config","routeConfig","routedComponentsPath","AppComponentName","AppComponent","NotFoundComponentName","NotFoundComponent","Object","keys","forEach","route","componentName","relayQueriesHelperPath","relayQueries","relayPrepareParams","relayPrepareParamsPath","appQueries","AppComponentQueriesName","appPrepareParams","AppPreparedParamsFuncName","reduxApiConfig","restReducerPath","restReducerFileName","use","fetch","helperTemplatePath","__dirname","readFile","readRouteConfigHelperTemplateErr","routeConfigHelperTemplateData","routeConfigObject","containerPath","relayQueriesPath","mainRoutePath","routePath","appComponentName","appComponentQueriesName","appName","name","map","key","idx","routeKeyName","routeIndex","routeName","breadcrumbName","breadcrumbIgnore","isIndexRoute","routePrepareParamFuncName","prepareParamFuncName","routeComponentName","routeComponentQueriesName","componentQueriesName","isLast","length","mkdir","frontendSrcPath","mkDirFrontendErr","code","helpersTargetPathName","mkDirHelperErr","routeHelperPathName","mkDirRoutesErr","writeFile","routeHelperFileName","render","toString","err","console","log","webpack","NO_WEBPACK","compiler","webpackConfig","port","parseInt","webpackPort","serverOptions","contentBase","webpackContentBaseProtocol","webpackContentBaseHost","webpackContentBasePort","quiet","noInfo","hot","inline","lazy","publicPath","output","stats","colors","app","listen","onAppListening","info","isoToolsConfig","appConfig","webpackConfigPath","webpackEnvironment","webpackConfigFileName","Promise","server","normalize","cwd","exports","module"],"mappings":"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","file":"frontend_service.js","sourcesContent":["global.__CLIENT__ = false;\nglobal.__SERVER__ = true;\nglobal.__DISABLE_SSR__ = false;\nglobal.__DEVTOOLS__ = global.__DEVELOPMENT__ = process.env.NODE_ENV !== 'production';\n\nrequire('es6-promise').polyfill();\n\nimport 'isomorphic-fetch';\nimport reduxApi from 'redux-api';\nimport adapterFetch from 'redux-api/lib/adapters/fetch';\n\nconst fs = require('fs');\nconst path = require('path');\nconst express = require('express');\nconst React = require('react');\nconst ReactDOM = require('react-dom/server');\nconst HtmlHelper = require('./helpers/Html');\nconst PrettyError = require('pretty-error');\nconst match = require('react-router').match;\nconst ReduxAsyncConnect = require('redux-async-connect').ReduxAsyncConnect;\nconst loadOnServer = require('redux-async-connect').loadOnServer;\nconst createHistory = require('react-router/lib/createMemoryHistory');\nconst Provider = require('react-redux').Provider;\nconst routesProvider = require('./routes/routes');\nconst createStore = require('./redux/create');\nconst pretty = new PrettyError();\nconst WebpackIsomorphicTools = require('webpack-isomorphic-tools');\nconst WebpackIsomorphicToolsConf = require('./helpers/devtools/webpack/webpack-isomorphic-tools');\nconst Webpack = require('webpack');\nconst mustache = require('mustache');\nconst nconf = require('nconf');\n\nfunction getFrontend(frontendConfig, reduxApiImpl, webpackIsomorphicTools) {\n  return function provideFrontend(req, res, next) {\n    if (__DEVELOPMENT__) {\n      // Do not cache webpack stats: the script file would change since\n      // hot module replacement is enabled in the development env\n      webpackIsomorphicTools.refresh();\n    }\n\n    const history = createHistory(req.originalUrl);\n    let reducer = null;\n    if (frontendConfig.reduxReducerPath) {\n      reducer = require(path.resolve(frontendConfig.reduxReducerPath, frontendConfig.reduxReducerFileName));\n    }\n\n    const store = createStore(frontendConfig, reducer(reduxApiImpl.reducers), history);\n\n    function hydrateOnClient() {\n      res.send('<!doctype html>\\n' + ReactDOM.renderToString(\n        <HtmlHelper config={frontendConfig}\n                    assets={webpackIsomorphicTools.assets()}\n                    store={store}/>\n        )\n      );\n    }\n\n    if (__DISABLE_SSR__) {\n      hydrateOnClient();\n      return;\n    }\n\n    match({\n      history,\n      routes: routesProvider(store, frontendConfig),\n      location: req.originalUrl\n    }, (error, redirectLocation, renderProps) => {\n      if (redirectLocation) {\n        res.redirect(redirectLocation.pathname + redirectLocation.search);\n      } else if (error) {\n        res.status(500);\n        hydrateOnClient();\n      } else if (renderProps) {\n        loadOnServer({ ...renderProps, store }).then(() => {\n          const component = (\n            <Provider store={store} key=\"provider\">\n              <ReduxAsyncConnect {...renderProps}/>\n            </Provider>\n          );\n\n          res.status(200);\n\n          global.navigator = { userAgent: req.headers['user-agent'] };\n\n          res.send('<!doctype html>\\n' + ReactDOM.renderToString(\n            <HtmlHelper config={frontendConfig}\n                        assets={webpackIsomorphicTools.assets()}\n                        component={component} store={store}/>\n            )\n          );\n        });\n      } else {\n        res.status(404).send('Not found');\n      }\n    });\n  }.bind(this);\n}\n\nclass FrontendService {\n  config = null;\n\n  constructor() {}\n\n  initialize() {\n    this.routeConfig = this.config.routeConfig;\n\n    if (this.config.routedComponentsPath) {\n      if (this.config.AppComponentName) {\n        this.config.AppComponent = require(path.resolve(this.config.routedComponentsPath, this.config.AppComponentName, this.config.AppComponentName));\n      }\n      if (this.config.NotFoundComponentName) {\n        this.config.NotFoundComponent = require(path.resolve(this.config.routedComponentsPath, this.config.NotFoundComponentName, this.config.NotFoundComponentName));\n      }\n    }\n\n    Object.keys(this.routeConfig).forEach((route) => {\n      if (this.routeConfig[route].componentName) {\n        this.routeConfig[route].component = require(path.resolve(this.config.routedComponentsPath, this.routeConfig[route].componentName, this.routeConfig[route].componentName));\n      }\n    });\n\n    if (this.config.relayQueriesHelperPath) {\n      this.config.relayQueries = require(path.resolve(this.config.relayQueriesHelperPath));\n      this.config.relayPrepareParams = require(path.resolve(this.config.relayPrepareParamsPath));\n      this.config.appQueries = (this.config.relayQueries && this.config.relayQueries[this.config.AppComponentQueriesName] ? this.config.relayQueries[this.config.AppComponentQueriesName] : null);\n      this.config.appPrepareParams = (this.config.AppPreparedParamsFuncName && this.config.relayPrepareParams && this.config.relayPrepareParams[this.config.AppPreparedParamsFuncName] ? this.config.relayPrepareParams[this.config.AppPreparedParamsFuncName] : null);\n    }\n\n    this.reduxApiConfig = require(path.resolve(this.config.restReducerPath, this.config.restReducerFileName));\n    this.reduxApiImpl = reduxApi(this.reduxApiConfig);\n    this.reduxApiImpl\n      .use(\"fetch\", adapterFetch(fetch))\n      .use(\"server\", true);\n\n    const helperTemplatePath = __dirname + '/templates/route_config_helper.mustache';\n\n    fs.readFile(helperTemplatePath, (readRouteConfigHelperTemplateErr, routeConfigHelperTemplateData) => {\n      if (readRouteConfigHelperTemplateErr) throw readRouteConfigHelperTemplateErr;\n\n      const routeConfigObject = {\n        containerPath: path.resolve(this.config.routedComponentsPath),\n        relayQueriesPath: path.resolve(this.config.relayQueriesHelperPath),\n        relayPrepareParamsPath: path.resolve(this.config.relayPrepareParamsPath),\n        mainRoutePath: this.config.routePath,\n        appComponentName: this.config.AppComponentName,\n        appComponentQueriesName: this.config.AppComponentQueriesName,\n        appName: this.config.appName,\n        name: this.config.name,\n        routes: Object.keys(this.config.routeConfig).map((key, idx) => {\n          return {\n            routeKeyName: key,\n            routeIndex: idx,\n            routeName: this.config.routeConfig[key].name,\n            breadcrumbName: this.config.routeConfig[key].breadcrumbName,\n            breadcrumbIgnore: this.config.routeConfig[key].breadcrumbIgnore || false,\n            routePath: this.config.routeConfig[key].path,\n            isIndexRoute: this.config.routeConfig[key].isIndexRoute,\n            routePrepareParamFuncName: this.config.routeConfig[key].prepareParamFuncName,\n            routeComponentName: this.config.routeConfig[key].componentName,\n            routeComponentQueriesName: this.config.routeConfig[key].componentQueriesName,\n            isLast: (idx >= Object.keys(this.config.routeConfig).length - 1)\n          }\n        })\n      };\n\n      //Routes are generated into the src and will be build into dist\n      // frontend\n      fs.mkdir(path.resolve(this.config.frontendSrcPath), (mkDirFrontendErr) => {\n        if (mkDirFrontendErr && mkDirFrontendErr.code != 'EEXIST') throw mkDirFrontendErr;\n\n        // helpers\n        fs.mkdir(path.resolve(this.config.frontendSrcPath, this.config.helpersTargetPathName), (mkDirHelperErr) => {\n          if (mkDirHelperErr && mkDirHelperErr.code != 'EEXIST') throw mkDirHelperErr;\n\n          // routes\n          fs.mkdir(path.resolve(this.config.frontendSrcPath, this.config.helpersTargetPathName, this.config.routeHelperPathName), (mkDirRoutesErr) => {\n            if (mkDirRoutesErr && mkDirRoutesErr.code != 'EEXIST') throw mkDirRoutesErr;\n\n              fs.writeFile(path.resolve(this.config.frontendSrcPath, this.config.helpersTargetPathName, this.config.routeHelperPathName, this.config.routeHelperFileName + '.js'), mustache.render(routeConfigHelperTemplateData.toString(), routeConfigObject), (err) => {\n              if (err) throw err;\n\n              console.log('RouteConfigHelper JS generated!');\n            });\n          });\n        });\n      });\n\n      if (this.config.webpack && process.env.NO_WEBPACK != \"1\") {\n        const compiler = Webpack(this.config.webpackConfig);\n\n        const port = parseInt(this.config.webpackPort);\n        const serverOptions = {\n          contentBase: this.config.webpackContentBaseProtocol + this.config.webpackContentBaseHost + ':' + this.config.webpackContentBasePort,\n          quiet: true,\n          noInfo: true,\n          hot: true,\n          inline: true,\n          lazy: false,\n          publicPath: this.config.webpackConfig.output.publicPath,\n          headers: { \"Access-Control-Allow-Origin\": '*' },\n          stats: { colors: true }\n        };\n\n        const app = new express();\n\n        app.use(require('webpack-dev-middleware')(compiler, serverOptions));\n        app.use(require('webpack-hot-middleware')(compiler));\n\n        app.listen(port, function onAppListening(err) {\n          if (err) {\n            console.error(err);\n          } else {\n            console.info('==> 🚧  Webpack development server listening on port %s', port);\n          }\n        });\n      }\n    });\n\n    const isoToolsConfig = WebpackIsomorphicToolsConf(this.config.appConfig);\n\n    if (this.config.webpack && this.config.webpackConfigPath) {\n      this.config.webpackConfig = require(path.resolve(this.config.webpackConfigPath, this.config.webpackEnvironment, this.config.webpackConfigFileName))(this.config, isoToolsConfig);\n    }\n\n    return new Promise((resolve) => {\n      this.webpackIsomorphicTools = new WebpackIsomorphicTools(isoToolsConfig).server(path.normalize(process.cwd()), () => {\n        resolve(true);\n      });\n    });\n  }\n\n  getFrontend() {\n    return getFrontend.bind(this)(this.config, this.reduxApiImpl, this.webpackIsomorphicTools);\n  }\n}\n\nexports = module.exports = FrontendService;\nexports.HtmlHelper = HtmlHelper;\nexports.FrontendService = FrontendService;\n"]}